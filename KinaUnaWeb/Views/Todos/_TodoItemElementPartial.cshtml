@using KinaUna.Data
@using KinaUna.Data.Extensions
@using KinaUnaWeb.Services
@model KinaUnaWeb.Models.TypeScriptModels.TodoItems.TodoItemResponse
@inject ILocaleManager LocaleManager
<button class="col-12 card-compact bg-todos todo-item" data-todo-id="@Model.TodoItemId" align="left" style="background: @Model.TodoItem.StatusBackgroundColor()">
    @if (Model.TodoItem.TodoItemId == 0)
    {
        <div>@await LocaleManager.GetTranslation("Nothing to see here yet.", PageNames.Notes, Model.LanguageId)</div>
    }
    else
    {
        <div class="row">
            <img src="@Model.TodoItem.Progeny.GetProfilePictureUrl()" style="position: absolute; right: 0; top: 0; max-height: 32px; margin-top: 2px; margin-right: 6px; margin-left: 4px; border-radius: 10px;" />
            <div class="col-auto card-compact-title text-left">
                <span class="pr-2"><i class="material-icons kinauna-icon-medium" style="font-size: 32px">@Model.TodoItem.StatusIcon()</i> </span>
                <span class="h5">
                    @Model.TodoItem.Title
                    @if (Model.TodoItem.SubtaskCount != 0)
                    {
                        <span class="text-appendage-light ml-2"> [@Model.TodoItem.CompletedSubtaskCount / @Model.TodoItem.SubtaskCount]</span>
                    }
                </span>
            </div>
            @if (!string.IsNullOrEmpty(Model.TodoItem.Tags) || !string.IsNullOrEmpty(Model.TodoItem.Context))
            {
                <div class="col mr-5">
                    @if (!string.IsNullOrEmpty(Model.TodoItem.Tags))
                    {
                        List<string> tagsList = Model.TodoItem.Tags.Split(',').ToList();
                        <div class="float-right ml-1 mr-1">
                            @foreach (string tagString in tagsList)
                            {
                                <span class="btn tag-item tag-item-xsm">@tagString</span>
                            }
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.TodoItem.Context))
                    {
                        List<string> contextsList = Model.TodoItem.Context.Split(',').ToList();
                        <div class="float-right ml-1 mr-1">
                            @foreach (string contextString in contextsList)
                            {
                                <span class="btn context-item tag-item-xsm">@contextString</span>
                            }
                        </div>
                    }
                </div>
            }
        </div>
        <div class="row">
            <div class="col-12 card-compact-body">
                <div class="row">
                    <div class="col-auto text-left mb-2">
                        
                        <span class="text-opacity-75">@await LocaleManager.GetTranslation("Status", PageNames.Todos, Model.LanguageId):</span> @await LocaleManager.GetTranslation(Model.TodoItem.StatusText(), PageNames.Todos, Model.LanguageId)
                    </div>
                </div>

                <div class="row">
                    @if (Model.TodoItem.DueDate.HasValue)
                    {
                        <div class="col-auto text-left"><span class="text-opacity-75">@await LocaleManager.GetTranslation("Due", PageNames.Todos, Model.LanguageId):</span> @Model.TodoItem.DueDate.Value.ToString("dd-MMM-yyyy")</div>
                    }
                    @if (Model.TodoItem.StartDate.HasValue)
                    {
                        <div class="col-auto text-left"><span class="text-opacity-75">@await LocaleManager.GetTranslation("Start", PageNames.Todos, Model.LanguageId):</span> @Model.TodoItem.StartDate.Value.ToString("dd-MMM-yyyy")</div>
                    }
                    @if (Model.TodoItem.CompletedDate.HasValue && Model.TodoItem.Status == (int)KinaUnaTypes.TodoStatusType.Completed)
                    {
                        <div class="col-auto text-left">
                            <span class="text-opacity-75">@await LocaleManager.GetTranslation("Completed Date", PageNames.Todos, Model.LanguageId): @Model.TodoItem.CompletedDate?.ToString("dd-MMM-yyyy")</span>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.TodoItem.Location))
                    {
                        <div class="col-auto text-left"><i class="material-icons" style="font-size: 18px;">location_on</i> @Model.TodoItem.Location</div>
                    }
                </div>
            </div>
        </div>

    }
</button>